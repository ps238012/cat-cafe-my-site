<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã”äºˆç´„ï½œçŒ«ã‚«ãƒ•ã‚§</title>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      background-color: #faf7f2;
      color: #333;
      margin: 0;
    }
    .container {
      max-width: 520px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    h1 {
      text-align: center;
      font-size: 22px;
      margin-bottom: 24px;
    }
    form {
      background-color: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      margin-top: 18px;
    }
    .required {
      color: #d66;
      font-size: 12px;
      margin-left: 4px;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    select {
      padding-right: 40px;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24'><path fill='%23999' d='M7 10l5 5 5-5z'/></svg>");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 14px;
      background-color: #fff;
    }
    textarea {
      resize: vertical;
      min-height: 90px;
    }
    .note {
      font-size: 12px;
      color: #777;
      margin-top: 6px;
      line-height: 1.5;
    }
    .error {
      color: #d33;
      font-size: 12px;
      margin-top: 6px;
      display: none;
    }
    button {
      width: 100%;
      margin-top: 28px;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 999px;
      background-color: #f2b6a0;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #eea489;
    }
    .footer-note {
      font-size: 12px;
      color: #666;
      margin-top: 22px;
      line-height: 1.6;
    }
    .complete {
      text-align: center;
      padding: 40px 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ¾ ã”äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h1>

    <form id="reservationForm">
      <label>
        ãŠãªã¾ãˆï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <input type="text" id="name" required placeholder="ä¾‹ï¼šãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦">

      <label>
        ãŠé›»è©±ç•ªå·
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <input type="tel" id="phone" required placeholder="ä¾‹ï¼š090-1234-5678">
      <div class="note">å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§ãƒã‚¤ãƒ•ãƒ³ãŒå…¥ã‚Šã¾ã™ã€‚</div>

      <label>
        ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <input type="email" id="email" required placeholder="example@email.com">
      <div class="note">ã”äºˆç´„å†…å®¹ã®ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚</div>

      <label>
        ã”æ¥åº—å¸Œæœ›æ—¥
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <input type="date" id="visitDate" required>
      <div class="note">â€»æœˆæ›œæ—¥ã¯å®šä¼‘æ—¥ã§ã™ã€‚</div>
      <div class="error" id="dateError">æœˆæ›œæ—¥ã¯ãŠé¸ã³ã„ãŸã ã‘ã¾ã›ã‚“ã€‚</div>

      <label>
        ã”æ¥åº—å¸Œæœ›æ™‚é–“
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <select id="timeSelect" required>
        <option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
      </select>
      <div class="note">10:00ã€œ20:00ï¼ˆ15åˆ†åˆ»ã¿ï¼‰</div>

      <label>
        ã”åˆ©ç”¨äººæ•°
        <span class="required">â€»å¿…é ˆ</span>
      </label>
      <select id="guests" required>
        <option value="">äººæ•°ã‚’é¸æŠ</option>
        <option>1å</option>
        <option>2å</option>
        <option>3å</option>
        <option>4å</option>
        <option>5åä»¥ä¸Š</option>
      </select>

      <label>
        ã”åˆ©ç”¨æ™‚é–“
      </label>
      <select id="duration">
        <option value="">æ™‚é–“ã‚’é¸æŠ</option>
        <option>30åˆ†</option>
        <option>60åˆ†</option>
        <option>90åˆ†</option>
        <option>120åˆ†</option>
        <option>120åˆ†ä»¥ä¸Š</option>
      </select>

      <label>ã”è¦æœ›ãƒ»ã”è³ªå•</label>
      <textarea id="message" placeholder="ä¾‹ï¼šã¯ã˜ã‚ã¦åˆ©ç”¨ã—ã¾ã™"></textarea>

      <button type="submit">ã­ã“ãŸã¡ã«ä¼šã„ã«è¡ŒãğŸ¾</button>

      <div class="footer-note">
        â€»æ··é›‘çŠ¶æ³ã«ã‚ˆã‚Šã”å¸Œæœ›ã«æ·»ãˆãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </form>
  </div>

  <script>
    // â–¼â–¼â–¼ ã“ã“ã«Colabã®URLã‚’è¨­å®šã—ã¾ã—ãŸ â–¼â–¼â–¼
    const API_BASE = "https://convert-within-hayes-download.trycloudflare.com";
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    /* é›»è©±ç•ªå·è‡ªå‹•ãƒã‚¤ãƒ•ãƒ³ */
    const phoneInput = document.getElementById("phone");
    phoneInput.addEventListener("input", () => {
      let v = phoneInput.value.replace(/[^0-9]/g, "");
      if (v.length > 3 && v.length <= 7) {
        v = v.slice(0,3) + "-" + v.slice(3);
      } else if (v.length > 7) {
        v = v.slice(0,3) + "-" + v.slice(3,7) + "-" + v.slice(7,11);
      }
      phoneInput.value = v;
    });

    const visitDate = document.getElementById("visitDate");
    const timeSelect = document.getElementById("timeSelect");
    const dateError = document.getElementById("dateError");
    const form = document.getElementById("reservationForm");

    visitDate.addEventListener("change", () => {
      const day = new Date(visitDate.value).getDay();
      if (day === 1) {
        visitDate.value = "";
        dateError.style.display = "block";
        timeSelect.innerHTML = `<option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>`;
        return;
      }
      dateError.style.display = "none";
      updateTimes();
    });

    function updateTimes() {
      timeSelect.innerHTML = `<option value="">æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>`;
      // æœ¬æ¥ã¯ã“ã“ã§ fetch(`${API_BASE}/api/slots?date=${visitDate.value}`) ã‚’ã—ã¦ç©ºãçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ãŒ
      // ã¾ãšã¯åŸºæœ¬çš„ãªäºˆç´„ãŒã§ãã‚‹ã‚ˆã†ã«å…ƒã®ã‚³ãƒ¼ãƒ‰ã®ã¾ã¾ã«ã—ã¦ã„ã¾ã™ã€‚
      
      for (let h = 10; h <= 20; h++) {
        for (let m = 0; m < 60; m += 15) {
          if (h === 20 && m > 0) break;
          const time = `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
          const option = document.createElement("option");
          option.value = time;
          option.textContent = time;
          timeSelect.appendChild(option);
        }
      }
    }

   form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // 1. å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å…¨éƒ¨é›†ã‚ã‚‹
      // (HTMLå´ã§ä¸€éƒ¨ id ã‚’è¿½åŠ ã—ãŸã®ã§ã€ã‚ˆã‚Šç¢ºå®Ÿã«å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ)
      const payload = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        date: visitDate.value,
        time: timeSelect.value,
        guests: document.getElementById("guests").value,
        duration: document.getElementById("duration").value,
        message: document.getElementById("message").value
      };

      try {
        // 2. Pythonã¸é€ä¿¡ (API_BASE ã‚’ä½¿ç”¨)
        // ãƒ—ãƒªãƒ³ãƒˆã®æŒ‡ç¤ºé€šã‚Š /api/reserve ã«é€ã‚Šã¾ã™
        const response = await fetch(`${API_BASE}/api/reserve`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const result = await response.json();

        // 3. çµæœï¼ˆresult.okï¼‰ã‚’è¦‹ã¦ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        if (result.ok) {
          form.innerHTML = `
            <div class="complete">
              <h2>ğŸ¾ äºˆç´„å®Œäº† ğŸ¾</h2>
              <p>${result.reservation.name}æ§˜ã€ã”äºˆç´„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p>
              <p>æ—¥ä»˜ï¼š${result.reservation.date} æ™‚é–“ï¼š${result.reservation.time}</p>
            </div>
          `;
        } else {
          alert("äºˆç´„ã‚¨ãƒ©ãƒ¼: " + (result.error || "è©³ç´°ä¸æ˜"));
        }

      } catch (error) {
        console.error("ã‚¨ãƒ©ãƒ¼:", error);
        alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ColabãŒå‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    });
  </script>
</body>
</html>


















